# Prophet4J

This is one tool to evaluate the correctness probability of patch (by learning from patches).

Usage
======

It is pretty convenient to run Prophet4J via CLI.

How to Build coming.jar?
----

```bash
mvn install:install-file -Dfile=lib/gumtree-spoon-ast-diff-0.0.3-SNAPSHOT-jar-with-dependencies.jar -DgeneratePom=true -DgroupId=fr.inria.spirals -DartifactId=gumtree-spoon-ast-diff -Dversion=0.0.3-SNAPSHOT -Dpackaging=jar
mvn -Dskiptest package
```

It is recommended to read the README file of Coming, in case command options getting changed.

How to Run Prophet4J?
----

```bash
java -classpath coming-0.1-SNAPSHOT-jar-with-dependencies.jar fr.inria.prophet4j.CLI
```

You could find help information by appending `--help`. Here is one snapshot.

```
$ java -classpath coming-0.1-SNAPSHOT-jar-with-dependencies.jar fr.inria.prophet4j.CLI --help
Usage: Prophet4J [--help] [--version] [-d=<dataOption>] [-f=<featureOption>]
                 [-p=<patchOption>] [-t=<task>]
Evaluate the correctness probability of patch (by learning existing patches)
      --help          display usage info
      --version       display version info
  -d, --data-option=<dataOption>
                      Data Option
                      default value: BUG_DOT_JAR_MINUS_MATH
                      valid values: CARDUMEN, SANER, BEARS, BUG_DOT_JAR_MINUS_MATH,
                        QUIX_BUGS
  -f, --feature-option=<featureOption>
                      Feature Option
                      default value: ORIGINAL
                      valid values: ENHANCED, EXTENDED, ORIGINAL, S4R, S4RO
  -p, --patch-option=<patchOption>
                      Patch Option
                      default value: BUG_DOT_JAR_MINUS_MATH
                      valid values: CARDUMEN, SPR, BEARS, BUG_DOT_JAR_MINUS_MATH,
                        QUIX_BUGS
  -t, --task=<task>   Task
                      default value: EXTRACT
                      valid values: EXTRACT, LEARN, EVALUATE
https://github.com/SpoonLabs/coming
```

All tasks run on predefined data-sets (shown above), among them, dataOption=SANER is valid only when patchOption=SPR, patchOption=SPR is valid except when featureOption=S4R/S4RO.

NOTICE: If you want to run the Evaluation task, you have to run the Learn task beforehand.

Development
======

In case you need to hack Prophet4J or continue the development.

Just follow instructions at [prophet4j-data](https://github.com/kth-tcs/overfitting-analysis/tree/master/prophet4j-data).

If you want existing feature-vectors, they are at [prophet4j-features](https://github.com/kth-tcs/overfitting-analysis/tree/master/prophet4j-features). If you want latest feature-vectors, they will be available at the `_JSON` folder.

If you want plot latest evaluation results, check generated ranking data at the `_BIN` folder and utilize `drawer.py` at [prophet4j-ranking](https://github.com/kth-tcs/overfitting-analysis/tree/master/prophet4j-ranking).

Project in Brief
======

Flow Chart
----

```
         +-------+               +-------------+
         |dataset+------+------->+human patches+----+
         +-------+      |        +-------------+    |
                        |                           |
                        |                           |       +-----------------+        +---------------+       +----------------+
                        +--------------+            +------>+feature|extractor+------->+feature|learner+------>+repair|evaluator|
                                       |            |       +-----------------+        +---------------+       +----------------+
                                       v            |
+----------------+         +-----------+-------+    |
|repair|generator+-------->+implausible patches+----+
+----------------+         +-------------------+
```

Features
----

Right now we have four feature-sets.
- [Original Features](https://github.com/SpoonLabs/coming/blob/master/docs/features/prophet4j/OriginalFeatures.md)
is basically features used in the vanilla prophet4j.
- [Extended Features](https://github.com/SpoonLabs/coming/blob/master/docs/features/prophet4j/ExtendedFeatures.md)
is literally the extended version of the original one, by appending more same-type features.
- Enhanced Features
is literally the enhanced version of the extended one, by appending more ways of crossing features.
- S4R Features
is basically features generated by sketch4repair.

Tree
----

```
.
├── CLI.java        // command-line interface
├── Demo.java       // source-code entry-point
├── dataset         // pkg handling dataset
│   ├── DataLoader.java         // cls loading data
│   ├── DataManager.java        // cls wrapping data
│   └── PGA.java                // (marginal, used to load commits from PGA)
├── feature         // pkg defining various feature-sets
│   ├── Feature.java            // cls defining the Feature entity
│   ├── FeatureCross.java       // cls defining the FeatureCross entity
│   ├── FeatureExtractor.java   // cls extracting features
│   ├── RepairGenerator.java    // cls generating repairs
│   ├── S4R                     // pkg wrapped the S4R feature-sets
│   ├── enhanced                // pkg defined the enhanced P4J feature-sets
│   ├── extended                // pkg defined the extended P4J feature-sets
│   └── original                // pkg defined the original P4J feature-sets
├── learner         // pkg learning and evaluating (will be decoupled from `coming`)
│   ├── FeatureLearner.java     // cls learning feature-weights by cross-entropy
│   ├── RepairEvaluator.java    // cls evaluating repairs by ranking them
│   └── Tool.java               // (marginal, used as one temporary script)
└── utility         // pkg supporting other packages
    ├── CodeDiffer.java         // cls wrapping workflow
    ├── Option.java             // cls defining some configuration-options
    ├── Structure.java          // cls defining some data-classes
    └── Support.java            // cls defining some static-methods
```

_Special Note_

`Feature` is entity to express feature or namely sub-characteristic

`FeatureCross` is entity to express characteristic by crossing corresponding features

`FeatureVector` is entity which contains feature-crosses to express characteristics of each diff-operation

`FeatureMatrix` is entity which contains feature-vectors to express multi-diff-operations of each patch

`ParameterVector` is entity which contains weights for all feature-crosses

Materials
======

[prophet4j-data](https://github.com/kth-tcs/overfitting-analysis/tree/master/prophet4j-data)

[prophet4j-features](https://github.com/kth-tcs/overfitting-analysis/tree/master/prophet4j-features)

[prophet4j-ranking](https://github.com/kth-tcs/overfitting-analysis/tree/master/prophet4j-ranking)

Reference
======

Prophet
----

[Prophet Code](http://rhino.csail.mit.edu/prophet-rep/)

[Prophet Paper](https://people.csail.mit.edu/fanl/papers/prophet-popl16.pdf)

[SPR Paper](https://people.csail.mit.edu/fanl/papers/spr-fse15.pdf)

[SPR Technical Report](https://dspace.mit.edu/bitstream/handle/1721.1/95970/MIT-CSAIL-TR-2015-008.pdf)

Others
---

[Spoon Document](http://spoon.gforge.inria.fr/index.html)

[Clang Namespace Reference](https://clang.llvm.org/doxygen/namespaceclang.html)

[CPP Reference](https://en.cppreference.com/w/)

[Oracle Java Tutorials](https://docs.oracle.com/javase/tutorial/java/index.html)
